---
title: "Preparing Data"
teaching: 30
exercises: 0
questions:
- "What to do before you can bring the data into R?"
objectives:
- "Identify different data types"
- "Recognise different types of visualisations"
keypoints:
- "Data should have 1 observation per row."
source: "Rmd"
---

```{r setup, include=FALSE}
source("../bin/chunk-options.R")
```

First, we need to load the `tidyverse` package (actually a collection of packages).

```{r packages, message=FALSE}
library(tidyverse)
```

We can now load the **Pattani** data from the Excel file. For the notes, this is stored
in the `data` directory. It might be different for you.

```{r read_data}
path <- file.path("..", "data", "Pattani.xlsx")
pattani <- readxl::read_excel(path, sheet = "Data", skip = 1)
```

`readxl::read_excel` is used to explicitly call the `read_excel` function in the `readxl`
package.

We would like to see what the data looks like now that it has been read into R. You can
just type the name of the dataset.

```{r print_pattani}
pattani
```

Having names with spaces in them can make them more difficult to work with. We can add to
the way that we read the file to modify the names.

```{r rename_columns}
pattani <- readxl::read_excel(path, sheet = "Data", skip = 1) %>%
  rename(blood_lead = `blood lead`, ln_blood_lead = `ln(blood lead)`)
```

> ## What does `%>%` mean?
> 
> `%>%` is something from the `tidyverse` called a **pipe**. It allows you to take the output
> from 1 function (in this case `read_excel`) and put it directly into another function
> (`rename`). It is as though there is a **pipe** connecting the functions together.
{: .callout}

Previously we got a preview of the data, but we might want to get some summary statistics
about the columns. You can use the function `summary` for this.

```{r summary}
summary(pattani)
```

Have a look at the `character` columns. What sort of variables are these?

If we convert these to `factor` then R knows that they are categorical variables and does
some helpful things for us. We will use the `as_factor` function, which is part of the
`tidyverse`. There is also a base R function `as.factor` (note the . instead of _) but we
will use the `tidyverse` version.

```{r convert_to_factors}
pattani <- readxl::read_excel(path, sheet = "Data", skip = 1) %>%
  rename(blood_lead = `blood lead`, ln_blood_lead = `ln(blood lead)`) %>%
  mutate(gender = as_factor(gender), school = as_factor(school), water = as_factor(water))
```

What happens if we run the summary now?

```{r summary_factors}
summary(pattani)
```

The factor variables now show the number of each element in the variables.

{% include links.md %}
