---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 04-correlation.md in _episodes_rmd/
title: "Correlation and Covariance"
author: "Dr Tania Prvan"
teaching: 60
exercises: 30
questions:
    - ""
objectives:
    - ""
keypoints:
    - ""
source: "Rmd"
mathjax: true
---





## Covariance and Correlation Coefficient

We are interested in studying the relationship between a response variable $Y$ and a single
predictor $X$.The covariance between $Y$ and $X$ measures the direction of the linear
relationship between $Y$ and $X$ but tells us nothing about the strength of the relationship
since it changes if we change the unit of measurement. If $Cov(Y,X)>0$ then there is a positive
relationship between $Y$ and $X$ but if $Cov(Y,X)<0$ the relationship is negative.

The correlation coefficient between $Y$ and $X$ is scale invariant so it measures both the
direction and strength of the linear relationship between $Y$ and $X$.

**EXAMPLE:** Anscomb (1973) used four data sets to illustrate the importance of investigating
the data using scatter plots and not relying totally on the correlation coefficient. The four
data sets are given below. Explore the data graphically and obtain the correlation coefficient
for each data set.
($r^2=\frac{\sum(x_i-\bar{x})(y_i-\bar{y})}{\sum(x_i-\bar{x})^2\sum(y_i-\bar{y})^2)}$)

The file `Anscombe.csv` contains this data.


~~~
library(tidyverse)
library(readr)
library(ggpubr)

anscomb <- read_csv(file.path("..", "data", "Anscomb.csv"))
anscomb
~~~
{: .language-r}



~~~
# A tibble: 11 x 8
      x1    y1    x2    y2    x3    y3    x4    y4
   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
 1    10  8.04    10  9.14    10  7.46     8  6.58
 2     8  6.95     8  8.14     8  6.77     8  5.76
 3    13  7.58    13  8.74    13 12.7      8  7.71
 4     9  8.81     9  8.77     9  7.11     8  8.84
 5    11  8.33    11  9.26    11  7.81     8  8.47
 6    14  9.96    14  8.1     14  8.84     8  7.04
 7     6  7.24     6  6.13     6  6.08     8  5.25
 8     4  4.26     4  3.1      4  5.39    19 12.5 
 9    12 10.8     12  9.13    12  8.15     8  5.56
10     7  4.82     7  7.26     7  6.42     8  7.91
11     5  5.68     5  4.74     5  5.73     8  6.89
~~~
{: .output}

<table class="table table-striped table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
<tr>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Data set 1</div></th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Data set 2</div></th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Data set 3</div></th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Data set 4</div></th>
</tr>
  <tr>
   <th style="text-align:right;"> x1 </th>
   <th style="text-align:right;"> y1 </th>
   <th style="text-align:right;"> x2 </th>
   <th style="text-align:right;"> y2 </th>
   <th style="text-align:right;"> x3 </th>
   <th style="text-align:right;"> y3 </th>
   <th style="text-align:right;"> x4 </th>
   <th style="text-align:right;"> y4 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 8.04 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 9.14 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 7.46 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 6.58 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 6.95 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 8.14 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 6.77 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 5.76 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 7.58 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 8.74 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 12.74 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 7.71 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 8.81 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 8.77 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 7.11 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 8.84 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 8.33 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 9.26 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 7.81 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 8.47 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 9.96 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 8.10 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 8.84 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 7.04 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 7.24 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 6.13 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 6.08 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 5.25 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 4.26 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 3.10 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 5.39 </td>
   <td style="text-align:right;"> 19 </td>
   <td style="text-align:right;"> 12.50 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 10.84 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 9.13 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 8.15 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 5.56 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 4.82 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 7.26 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 6.42 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 7.91 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 5.68 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 4.74 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 5.73 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 6.89 </td>
  </tr>
</tbody>
</table>

Now we want to see what each data set looks like.


~~~
p1 <- ggplot(anscomb, aes(x = x1, y = y1)) + geom_point()
p2 <- ggplot(anscomb, aes(x = x2, y = y2)) + geom_point()
p3 <- ggplot(anscomb, aes(x = x3, y = y3)) + geom_point()
p4 <- ggplot(anscomb, aes(x = x4, y = y4)) + geom_point()

ggarrange(p1, p2, p3, p4, ncol = 2, nrow = 2)
~~~
{: .language-r}

<img src="../fig/rmd-04-anscomb_plot-1.png" title="plot of chunk anscomb_plot" alt="plot of chunk anscomb_plot" width="612" style="display: block; margin: auto;" />

Base R has the `cor` function to produce correlations and the `cov` function to produce
covariances. The default is Pearson's correlation.


~~~
cor(anscomb$x1, anscomb$y1)
cor(anscomb$x2, anscomb$y2)
cor(anscomb$x3, anscomb$y3)
cor(anscomb$x4, anscomb$y4)
~~~
{: .language-r}



~~~
[1] 0.8164205
[1] 0.8162365
[1] 0.8162867
[1] 0.8165214
~~~
{: .output}

To two decimal places, all 4 sets of data have
0.82
correlation yet the plots don't all look linear. Just because you have a high correlation is not
a sufficient reason to fit a straight line to the data. Even though Data Set 2 has high positive
correlation it is obvious from the plot of `y2` vs `x2` that a perfect nonlinear relationship
describes the relationship between the two variables better. Looking at the plot of `y3` versus
`x3` it is obvious if it wasn't for the second last data point the relationship would be
perfectly linear with a positive slope. Look at the last plot, if it wasn't for the point on its
own there would be no relationship between `y4` and `x4`, such a point is called highly
influential because if it was removed the curve fitted would be very different. Only the plot of
`y1` versus `x1` could be considered to be approximately linear.

{% include links.md %}
