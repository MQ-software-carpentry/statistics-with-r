---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-preparing-data.md in _episodes_rmd/
title: "Preparing Data"
teaching: 30
exercises: 0
questions:
- "What to do before you can bring the data into R?"
objectives:
- "Identify different data types"
- "Recognise different types of visualisations"
keypoints:
- "Data should have 1 observation per row."
source: "Rmd"
---



First, we need to load the `tidyverse` package (actually a collection of packages).


~~~
library(tidyverse)
~~~
{: .language-r}

We can now load the **Pattani** data from the Excel file. For the notes, this is stored
in the `data` directory. It might be different for you.


~~~
path <- file.path("..", "data", "Pattani.xlsx")
pattani <- readxl::read_excel(path, sheet = "Data", skip = 1)
~~~
{: .language-r}

`readxl::read_excel` is used to explicitly call the `read_excel` function in the `readxl`
package.

We would like to see what the data looks like now that it has been read into R. You can
just type the name of the dataset.


~~~
pattani
~~~
{: .language-r}



~~~
# A tibble: 434 x 8
      ID `blood lead`   age gender school   duration water `ln(blood lead)`
   <dbl>        <dbl> <dbl> <chr>  <chr>       <dbl> <chr>            <dbl>
 1     1         11.7    13 Boy    Tangkad~       13 Boil              2.46
 2     2         11.8    13 Boy    Tangkad~        5 Boil              2.47
 3     3          6.4    13 Girl   Tangkad~       13 Stand             1.86
 4     4          6.9    11 Girl   Tangkad~       11 Boil              1.93
 5     5         10.3    13 Girl   Tangkad~        5 Boil              2.33
 6     6          8.3    13 Girl   Tangkad~       13 Filt~             2.12
 7     7          6.2    13 Girl   Tangkad~        5 Filt~             1.82
 8     8          9.4    13 Boy    Tangkad~       13 Stand             2.24
 9     9         14.9    11 Boy    Tangkad~       11 Boil              2.70
10    10          8.1    11 Girl   Tangkad~       11 Filt~             2.09
# ... with 424 more rows
~~~
{: .output}

Having names with spaces in them can make them more difficult to work with. We can add to
the way that we read the file to modify the names.


~~~
pattani <- readxl::read_excel(path, sheet = "Data", skip = 1) %>%
  rename(blood_lead = `blood lead`, ln_blood_lead = `ln(blood lead)`)
~~~
{: .language-r}

> ## What does `%>%` mean?
> 
> `%>%` is something from the `tidyverse` called a **pipe**. It allows you to take the output
> from 1 function (in this case `read_excel`) and put it directly into another function
> (`rename`). It is as though there is a **pipe** connecting the functions together.
{: .callout}

Previously we got a preview of the data, but we might want to get some summary statistics
about the columns. You can use the function `summary` for this.


~~~
summary(pattani)
~~~
{: .language-r}



~~~
       ID          blood_lead         age            gender         
 Min.   :  1.0   Min.   : 4.00   Min.   : 5.000   Length:434        
 1st Qu.:116.2   1st Qu.: 8.70   1st Qu.: 8.000   Class :character  
 Median :231.5   Median :11.70   Median : 9.000   Mode  :character  
 Mean   :229.5   Mean   :12.05   Mean   : 9.281                     
 3rd Qu.:344.8   3rd Qu.:14.70   3rd Qu.:11.000                     
 Max.   :454.0   Max.   :28.30   Max.   :13.000                     
                 NA's   :1                                          
    school             duration         water           ln_blood_lead  
 Length:434         Min.   : 2.000   Length:434         Min.   :1.386  
 Class :character   1st Qu.: 5.000   Class :character   1st Qu.:2.163  
 Mode  :character   Median : 8.000   Mode  :character   Median :2.460  
                    Mean   : 7.922                      Mean   :2.425  
                    3rd Qu.:10.000                      3rd Qu.:2.688  
                    Max.   :13.000                      Max.   :3.343  
                                                        NA's   :1      
~~~
{: .output}

Have a look at the `character` columns. What sort of variables are these?

If we convert these to `factor` then R knows that they are categorical variables and does
some helpful things for us. We will use the `as_factor` function, which is part of the
`tidyverse`. There is also a base R function `as.factor` (note the . instead of _) but we
will use the `tidyverse` version.


~~~
pattani <- readxl::read_excel(path, sheet = "Data", skip = 1) %>%
  rename(blood_lead = `blood lead`, ln_blood_lead = `ln(blood lead)`) %>%
  mutate(gender = as_factor(gender), school = as_factor(school), water = as_factor(water))
~~~
{: .language-r}

What happens if we run the summary now?


~~~
summary(pattani)
~~~
{: .language-r}



~~~
       ID          blood_lead         age          gender   
 Min.   :  1.0   Min.   : 4.00   Min.   : 5.000   Boy :204  
 1st Qu.:116.2   1st Qu.: 8.70   1st Qu.: 8.000   Girl:230  
 Median :231.5   Median :11.70   Median : 9.000             
 Mean   :229.5   Mean   :12.05   Mean   : 9.281             
 3rd Qu.:344.8   3rd Qu.:14.70   3rd Qu.:11.000             
 Max.   :454.0   Max.   :28.30   Max.   :13.000             
                 NA's   :1                                  
        school       duration          water     ln_blood_lead  
 Tangkadeng:136   Min.   : 2.000   Boil   :163   Min.   :1.386  
 Thamthalu : 46   1st Qu.: 5.000   Stand  :163   1st Qu.:2.163  
 Tachi     :128   Median : 8.000   Filter : 48   Median :2.460  
 Tesabal 3 : 62   Mean   : 7.922   Nothing: 56   Mean   :2.425  
 Sabarang  : 62   3rd Qu.:10.000   NA's   :  4   3rd Qu.:2.688  
                  Max.   :13.000                 Max.   :3.343  
                                                 NA's   :1      
~~~
{: .output}

The factor variables now show the number of each element in the variables.

{% include links.md %}
